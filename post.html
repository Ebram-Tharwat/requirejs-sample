<p>The role of JavaScript for application development has seen a serious uptick over the past few years. Just a few years ago, we would use JavaScript for client-side form validation and some AJAX and UI tricks using Prototype and Scriptaculous. Even more sophisticated started to pop up, like Dojo, ExtJS and the JQuery / JQuery UI combo. It became possible to create feature-rich applications with near-desktop fidelity, all using JavaScript in the browser.</p>

<p>With that growth though, JavaScript started to creak at the seams with some of the limitations of the language. Douglas Crockford's <a href="http://www.amazon.com/dp/0596517742" target="blank">"JavaScript: the Good Parts"</a> provided a thoughtful guide for how to avoid the dangerous areas of the language, but there are some constructs present in languages like Java, C++ and C# that have to be improvised in JavaScript.</p>

<p>One of the biggest gaps has been in modular programming. JavaScript has no direct language support of namespaces or module loading. This is the sort of modularity addressed by the <code>package</code> keyword in Java or <code>namespace</code> in C# or C++. Various libraries have created their own workarounds to this code modularity issue, but there isn't anything native in the current ECMAScript specification to address this.</p>

<p>Fortunately, out of this vacuum, two strong frameworks have emerged. For server-side work, <a href="http://nodejs.org" target="_blank">NodeJS</a> embraced the <a href="http://www.commonjs.org" target="_blank">CommonJS</a> standard. For client-side work, <a href="https://github.com/amdjs/amdjs-api/wiki/AMD" target="_blank">Asynchronous Module Definition (AMD)</a>, as implemented in <a href="http://requirejs.org" target="_blank">RequireJS</a>, has emerged as a rallying point for writing modular code.</p>

<p>Making effective use of RequireJS requires a mindset shift of developers. In the "good" old days, a developer would successively load a series of JavaScript files through the <code>&lt;script&gt;</code> tag. This was simple enough for a few files, but it quickly turns in to a maintenance nightmare in a JavaScript-heavy application. Without a clear way to define modules, JavaScript code can quickly become convoluted and difficult to maintain. Loading multiple JavaScript files via the <code>&lt;script&gt;</code> tag can also drag down application performance as the user has to wait for the scripts to load to interact with the application.</p>

<p>RequireJS brings sanity to this situation. It provides not only a clear definition for what is a module, but it also provides the mechanism to load the modules asynchronously. This improves code maintainability and also performance by allowing a page to only load the modules it needs.</p>

<h4>Modules</h4>

<p>The key concept with RequireJS and AMD is the module. A module is simply a JavaScript function that returns a value. That value is typically another function or a JavaScript object. For example, a simple module that defines a way to convert a String to uppercase might look like this:</p>

<pre lang="javascript">
define(function() {
    return function(s) { return s.toUpperCase(); };
});
</pre>

<p>The global <code>define()</code> function is created by the RequireJS library and allows the definition of a module. Convention is to use the name of the file as the name of the module, so if we save this snippet as  <code>upper.js</code> we could make use of this module like this:</p>

<pre lang="javascript">
require(['upper'],function(upper) {
    console.log( upper('hello world') );
});
</pre>

<p>In this case, we use the global RequireJS <code>require()</code> method to specify some code we want to execute, along with its dependencies, which is the <i>upper</i> module created above. RequireJS express this relationship by having the first parameter to the <code>require()</code> call be an array of the modules our code will depend on. RequireJS will deal with loading the dependencies and will pass each dependency, in order, to the function that is the module definition. The parameter name is arbitrary, but convention is to use the name of the module.</p>

<p>This is a pretty basic example to demonstrate what a module is. Now w'll put some rubber to the road and show a more complete picture. The code for this is up on my <a href="https://github.com/timsporcic/requirejs-sample">GitHub account</a>, so you can grab it for yourself.</p>

<p>This example uses RequireJS, <a href="http://jquery.com" target="_blank">JQuery</a>, <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>, the <a href="http://olado.github.com/doT/" target="_blank">doT</a> templating engine, and some RequireJS plugins to create a simple page that generates a table via templates and a modal dialog to edit the row when clicked on. We'll be using a JSON file as the datasource, so there is no updating, but this eliminates the need for a backend in the example.</p>

<p>Note that we're using the version of RequireJS which <a href="http://requirejs.org/docs/download.html" target="_blank">includes JQuery</a>. Since JQuery is not AMD-aware, this combined RequireJS/JQuery is the easiest was to include JQuery as a module.</p>

<h4>The Main Page</h4>

<p>The <code>&lt;head&gt;</code> element of the <code>index.html</code> sets up RequireJS and the Bootstrap CSS file. Note the <code>data-main</code> attribute on the <code>&lt;script&gt;</code> tag on <b>line 7</b> that loads RequireJS. This specifies the overall application-level JavaScript file used by RequireJS. It means RequireJS will attempt to load a file called main.js under the <code>scripts</code> directory.</p>

<pre lang="html" line="1" escaped="true">
&lt;!DOCTYPE html>
&lt;html>
&lt;head>
  &lt;meta charset="utf-8">
  &lt;title>RequireJS Sample&lt;/title>
  &lt;link rel="stylesheet" href="styles/bootstrap.css">
  &lt;script src="scripts/require-jquery.js" data-main="scripts/main">&lt;/script>
&lt;/head>
&lt;body>

&lt;div class="container">

  &lt;div class="page-header">
    &lt;h1>Customers
      &lt;small>A RequireJS version&lt;/small>
    &lt;/h1>
  &lt;/div>

  &lt;div class="row">
    &lt;div class="span8">
      &lt;table class="table-bordered table" id="customer-table">
        &lt;thead>
        &lt;tr>
          &lt;th>First Name&lt;/th>
          &lt;th>Last Name&lt;/th>
          &lt;th>Action&lt;/th>
        &lt;/tr>
        &lt;/thead>
        &lt;tbody id="customer-rows">

        &lt;/tbody>
      &lt;/table>
    &lt;/div>
  &lt;/div>
&lt;/div>

&lt;div class="modal hide fade" id="customer-modal">
  &lt;div class="modal-header">
    &lt;button type="button" class="close" data-dismiss="modal">Ã—&lt;/button>
    &lt;h3>Customer&lt;/h3>
  &lt;/div>
  &lt;div class="modal-body" id="modal-body">

  &lt;/div>
  &lt;div class="modal-footer">
    &lt;a href="#" class="btn btn-success save-customer">Save&lt;/a>
    &lt;a href="#" class="btn" data-dismiss="modal">Close&lt;/a>
  &lt;/div>
&lt;/div>

&lt;/body>
&lt;/html>
</pre>


<p>The rest of the <code>index.html</code> file sets up an empty table where we'll display the rows of data using a template. It also defines a Bootstrap modal dialog, again with an empty body which will get populated with a template.</p>

<h4>RequireJS Configuration</h4>

<p>The contents of the <code>main.js</code> file setup the RequireJS modules and do our page setup when the required modules are loaded. This is handled via the <code>require.config()</code> call at the top of the file.</p>

<pre lang="javascript" line="1">
require.config({
  paths: {
    bootstrap: 'lib/bootstrap.min',
    doT: 'lib/doT.min',
    views: 'templates/templates',
    datasource: 'data/json-datasource'
  },
  shim: {
    'bootstrap': ['jquery']
  }
});

require(['jquery','datasource','views','bootstrap','domReady!'],
    function($,datasource,views){

  $('#customer-rows').html( views.tablerow( datasource.list() ));

  $('#customer-table').on('click','a.edit-customer', function(e) {
    e.preventDefault();
    var idx = $(this).data('id');
    $('#modal-body').html( views.dialog( datasource.get(idx) ));
    $('#customer-modal').modal('show');
  });

  $('#customer-modal').on('click','a.save-customer', function(e){
    e.preventDefault();
    datasource.update( $('#customer-form').serialize() );
    $('#customer-modal').modal('hide');
  });
});
</pre>

<p>RequireJS has numerous, well-documented <a href="http://requirejs.org/docs/api.html#config" target="_blank"> configuration options</a>. We use the <code>paths</code> option to specify the location of the external dependencies we plan on using. The <code>paths</code> options keeps us from having to hard-code the path to a library in each modules. For example, instead of specifying <code>['lib/bootstrap']</code> as a module dependency, configuring the path lets us do this <code>['bootstrap']</code>. This provides a nice level of abstraction which will also make code  maintenance easier if we need to change something.</p>

<p>Note that none of the dependencies defined in the config have a file extension. RequireJS will automatically append the <code>.js</code> when it attempts to load the actual file. The location of the dependencies is relative to the location of the <code>main.js</code> file, although that can be altered via configuration options.</p>

<p>The <code>shim</code> provides a way of specifying dependencies that aren't configured as AMD modules. Here we're indicating that the <i>bootstrap</i> module depends on <i>jquery</i> and it must be loaded first. Since there is no guarantee on loading order for modules defined as dependencies, the <code>shim</code> option allows for the easy integration of non-AMD libraries that need dependencies themselves.</p>

<p>The bottom half of <code>main.js</code> actually does some work. The <code>require()</code> method is used to load our dependencies and execute some code. On <b>line 13</b> we indicate we are going to use the <i>jquery</i>, <i>datasource</i>, <i>views</i>, and <i>bootstrap</i> modules. We also require the <i>domReady!</i> module. This is one of the <a href="http://requirejs.org/docs/download.html#plugins" target="_blank"> core plugins</a> for RequireJS. Since we want to manipulate the DOM in our function, we need to ensure it is ready. Since RequireJS loads modules asynchronously, it could load all our modules before the DOM is ready to go. The <i>domReady!</i> plugin will wait to ensure the DOM is ready before calling our function. The exclamation point in the name is a plugin feature that shortcuts the plugin to not require us to declare it as a parameter to our function.</p>

<p>On <b>line 14</b> we define the function that will get called when all the required modules are loaded. Each parameter to the function corresponds to one of the modules we required, in order. Since Bootstrap is not AMD-aware, and just piggybacks on JQuery, we don't need to add a parameter for it.</p>

<p><b>Line 16<b> has a lot going on. We're calling the <code>list()</code> method of the <i>datasource</i> module to get a JSON array of the rows we are going to render in the table. We then pass the results to the <code>tablerow()</code> method of the <i>views</i> module, which will generate the HTML for the table body. Finally, we use some JQuery to insert the generated HTML into the table on the page.</p>

<p><b>Lines 18 and 25</b> add some event listeners to both the anchor tag in the table row and the Save button on the modal. They follow the same pattern above, making use of the <i>datasource</i> and <i>views</i> modules to get data and format it for display.</p>

<h3>The Views</h3>

<p>The <code>templates.js</code> file in the templates directory handles loading the doT templates from HTML files and generating the content based on the JSON data provided:</p>

<pre lang="javascript" line="1">
define(['doT',
        'text!templates/table-row.html',
        'text!templates/dialog.html'],
        function(doT, tablerowText, dialogText){

  return {
      tablerow: doT.template(tablerowText),
      dialog: doT.template(dialogText)
  };
});
</pre>


(RequireJS Sample Code)[https://github.com/timsporcic/requirejs-sample]

(Extra RequireJS Plugins)[https://github.com/millermedeiros/requirejs-plugins]

